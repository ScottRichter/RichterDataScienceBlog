---
title: Bank Data Preprocessing
author: Scott Richter
date: '2021-09-24'
slug: []
categories: []
tags: []
output: html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = 'C:/Users/srich/Desktop/Analytics Projects/Power BI - Banking Data')
```

A quick script to examine and prepare banking data for a Power BI dashboard to show to Ron and Greg. I begin by importing data from a publicly available dataset on banking clients, then get a cursory understanding of the data before modeling it in a Power BI dashboard.

Data pulled from:
["Banking Dataset - Marketing Targets"]("https://www.kaggle.com/prakharrathi25/banking-dataset-marketing-targets")

Dataset citation:
*S. Moro, P. Cortez and P. Rita. A Data-Driven Approach to Predict the Success of Bank Telemarketing. Decision Support Systems, Elsevier, 62:22-31, June 2014*

## Setup
```{r, message=FALSE}
# CSG Pro colors
CSGblue <- "#00a7db"
CSGblack <- "#231f20"

# Libraries
library(tidyverse)  # General purpose data manipulation and analysis
library(kableExtra) # HTML tables
library(stringr)    # Text/string manipulation

# Load data, separating entries by semicolon
train <- read.csv("train.csv", sep = ";")
test <- read.csv("test.csv", sep = ";")

# Combine train and test into a larger dataset for Power BI
bankdataraw <- bind_rows(train, test) %>% rename(subscribed = y)

# Peek at the first 5 rows of the combined dataset
kable(head(bankdataraw), caption = "A Glimpse Into The Banking Client Dataset") %>%
  kable_paper("hover", full_width = F)

# Unload the train and test datasets
rm(list = c("train", "test"))
```

## First look

Explanation of banking client variables:  


| Variable   | Description                                                                                    |
| :---       | :---                                                                                           |
| age        | Age of the client                                                                              |
| job        | Job type of the client, i.e. services, management, student, retired                            |
| marital    | Marital status: married, divorced (includes widowed), single                                   |
| education  | Education status: unknown, primary, secondary, tertiary                                        |
| default    | Does client have credit in default? Yes or no                                                  |
| balance    | Average yearly account balance in Euros                                                        |
| housing    | Does client have a housing loan? Yes or no                                                     |
| loan       | Does client have a personal loan? Yes or no                                                    |
| contact    | Contact communication type: telephone, cellular, unknown                                       |
| day        | Last contact day of the month                                                                  |
| month      | Last contact month of the year, i.e. jan, feb, mar                                             |
| duration   | Last contact duration in seconds                                                               |
| campaign   | Number of contacts performed during this campaign for this client                              |
| pdays      | Number of days passed since last contact from previous campaign. -1 means no previous contact  |
| previous   | Number of contacts performed before this campaign for this client                              |
| poutcome   | Outcome of previous marketing campaign on client: success, failure, unknown, other             |
| subscribed | Has the client subscribed to a term deposit? Yes or no                                         |



```{r}
# What does the structure of this dataset look like?
str(bankdataraw)

# The combined dataset contains just shy of 50,000 bank clients
```

## Tidying things up for presentation in Power BI

```{r}
# Ensure proper data types and capitalize factors for Power BI dash
bankdata <- bankdataraw %>%
  mutate(job = as.factor(str_to_title(job)),
         marital = as.factor(str_to_title(marital)),
         education = as.factor(str_to_title(education)),
         default = as.factor(str_to_title(default)),
         housing = as.factor(str_to_title(housing)),
         loan = as.factor(str_to_title(loan)),
         contact = as.factor(str_to_title(contact)),
         month = as.factor(str_to_title(month)),
         poutcome = as.factor(str_to_title(poutcome)),
         subscribed = as.factor(str_to_title(subscribed)))

# Any NA's in the dataframe?
sum(is.na(bankdata)) # None




# Remove raw bank data from environment
rm(bankdataraw)

# A look at the head of the new data
kable(head(bankdata), caption = "Prepared Banking Dataset") %>%
  kable_paper("hover", full_width = F)

# Write the .csv to be used in Power BI
write.csv(bankdata, file = "bankdata.csv")
```

## Summary statistics
```{r}
# A quick overview of the banking client data
fullsummary <- summary(bankdata)
fullsummary
```
\n
\n

Notes:  

- Half of all clients are between 33 and 48 years old.
- Most clients work blue-collar or management jobs (around 21% for each).
- About 3/5 clients are married.
- Most clients have at least a secondary education (80%).
- A very small portion (1.79%) of clients are in default.
- More clients have housing loans than do not, but it's not a huge difference (55% vs. 45%).
- Most clients don't have a personal loan. Only about 16% do.
- If a client was contacted, they were probably contacted through their cellular (64%).
- Most clients were contacted in May (30%). Late spring into summer is most popular for contact.
- Half of all contacts made with customers lasted between 1:43 and 5:20.
- The average customer was contacted twice during this campaign. 
- Only 25% of customers were contacted three or more times.
- Most customers have not been contacted prior to this campaign.
- Only 11.68% of customers have subscribed to a term deposit.
