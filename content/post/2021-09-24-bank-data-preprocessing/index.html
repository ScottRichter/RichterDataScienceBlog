---
title: Bank Data Preprocessing
author: Scott Richter
date: '2021-09-24'
slug: []
categories: []
tags: []
output: html
---

<script src="{{< blogdown/postref >}}index_files/kePrint/kePrint.js"></script>
<link href="{{< blogdown/postref >}}index_files/lightable/lightable.css" rel="stylesheet" />


<p>A quick script to examine and prepare banking data for a Power BI dashboard to show to Ron and Greg. I begin by importing data from a publicly available dataset on banking clients, then get a cursory understanding of the data before modeling it in a Power BI dashboard.</p>
<p>Data pulled from:
<a href="%22https://www.kaggle.com/prakharrathi25/banking-dataset-marketing-targets%22">“Banking Dataset - Marketing Targets”</a></p>
<p>Dataset citation:
<em>S. Moro, P. Cortez and P. Rita. A Data-Driven Approach to Predict the Success of Bank Telemarketing. Decision Support Systems, Elsevier, 62:22-31, June 2014</em></p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<pre class="r"><code># CSG Pro colors
CSGblue &lt;- &quot;#00a7db&quot;
CSGblack &lt;- &quot;#231f20&quot;

# Libraries
library(tidyverse)  # General purpose data manipulation and analysis
library(kableExtra) # HTML tables
library(stringr)    # Text/string manipulation

# Load data, separating entries by semicolon
train &lt;- read.csv(&quot;train.csv&quot;, sep = &quot;;&quot;)
test &lt;- read.csv(&quot;test.csv&quot;, sep = &quot;;&quot;)

# Combine train and test into a larger dataset for Power BI
bankdataraw &lt;- bind_rows(train, test) %&gt;% rename(subscribed = y)

# Peek at the first 5 rows of the combined dataset
kable(head(bankdataraw), caption = &quot;A Glimpse Into The Banking Client Dataset&quot;) %&gt;%
  kable_paper(&quot;hover&quot;, full_width = F)</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<caption>
<span id="tab:unnamed-chunk-1">Table 1: </span>A Glimpse Into The Banking Client Dataset
</caption>
<thead>
<tr>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
job
</th>
<th style="text-align:left;">
marital
</th>
<th style="text-align:left;">
education
</th>
<th style="text-align:left;">
default
</th>
<th style="text-align:right;">
balance
</th>
<th style="text-align:left;">
housing
</th>
<th style="text-align:left;">
loan
</th>
<th style="text-align:left;">
contact
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:left;">
month
</th>
<th style="text-align:right;">
duration
</th>
<th style="text-align:right;">
campaign
</th>
<th style="text-align:right;">
pdays
</th>
<th style="text-align:right;">
previous
</th>
<th style="text-align:left;">
poutcome
</th>
<th style="text-align:left;">
subscribed
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
58
</td>
<td style="text-align:left;">
management
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
tertiary
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
2143
</td>
<td style="text-align:left;">
yes
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
may
</td>
<td style="text-align:right;">
261
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
</tr>
<tr>
<td style="text-align:right;">
44
</td>
<td style="text-align:left;">
technician
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
secondary
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
yes
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
may
</td>
<td style="text-align:right;">
151
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
entrepreneur
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
secondary
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
yes
</td>
<td style="text-align:left;">
yes
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
may
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
</tr>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:left;">
blue-collar
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
1506
</td>
<td style="text-align:left;">
yes
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
may
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
may
</td>
<td style="text-align:right;">
198
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
</tr>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:left;">
management
</td>
<td style="text-align:left;">
married
</td>
<td style="text-align:left;">
tertiary
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:right;">
231
</td>
<td style="text-align:left;">
yes
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
may
</td>
<td style="text-align:right;">
139
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
no
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Unload the train and test datasets
rm(list = c(&quot;train&quot;, &quot;test&quot;))</code></pre>
</div>
<div id="first-look" class="section level2">
<h2>First look</h2>
<p>Explanation of banking client variables:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="left">Age of the client</td>
</tr>
<tr class="even">
<td align="left">job</td>
<td align="left">Job type of the client, i.e. services, management, student, retired</td>
</tr>
<tr class="odd">
<td align="left">marital</td>
<td align="left">Marital status: married, divorced (includes widowed), single</td>
</tr>
<tr class="even">
<td align="left">education</td>
<td align="left">Education status: unknown, primary, secondary, tertiary</td>
</tr>
<tr class="odd">
<td align="left">default</td>
<td align="left">Does client have credit in default? Yes or no</td>
</tr>
<tr class="even">
<td align="left">balance</td>
<td align="left">Average yearly account balance in Euros</td>
</tr>
<tr class="odd">
<td align="left">housing</td>
<td align="left">Does client have a housing loan? Yes or no</td>
</tr>
<tr class="even">
<td align="left">loan</td>
<td align="left">Does client have a personal loan? Yes or no</td>
</tr>
<tr class="odd">
<td align="left">contact</td>
<td align="left">Contact communication type: telephone, cellular, unknown</td>
</tr>
<tr class="even">
<td align="left">day</td>
<td align="left">Last contact day of the month</td>
</tr>
<tr class="odd">
<td align="left">month</td>
<td align="left">Last contact month of the year, i.e. jan, feb, mar</td>
</tr>
<tr class="even">
<td align="left">duration</td>
<td align="left">Last contact duration in seconds</td>
</tr>
<tr class="odd">
<td align="left">campaign</td>
<td align="left">Number of contacts performed during this campaign for this client</td>
</tr>
<tr class="even">
<td align="left">pdays</td>
<td align="left">Number of days passed since last contact from previous campaign. -1 means no previous contact</td>
</tr>
<tr class="odd">
<td align="left">previous</td>
<td align="left">Number of contacts performed before this campaign for this client</td>
</tr>
<tr class="even">
<td align="left">poutcome</td>
<td align="left">Outcome of previous marketing campaign on client: success, failure, unknown, other</td>
</tr>
<tr class="odd">
<td align="left">subscribed</td>
<td align="left">Has the client subscribed to a term deposit? Yes or no</td>
</tr>
</tbody>
</table>
<pre class="r"><code># What does the structure of this dataset look like?
str(bankdataraw)</code></pre>
<pre><code>## &#39;data.frame&#39;:    49732 obs. of  17 variables:
##  $ age       : int  58 44 33 47 33 35 28 42 58 43 ...
##  $ job       : chr  &quot;management&quot; &quot;technician&quot; &quot;entrepreneur&quot; &quot;blue-collar&quot; ...
##  $ marital   : chr  &quot;married&quot; &quot;single&quot; &quot;married&quot; &quot;married&quot; ...
##  $ education : chr  &quot;tertiary&quot; &quot;secondary&quot; &quot;secondary&quot; &quot;unknown&quot; ...
##  $ default   : chr  &quot;no&quot; &quot;no&quot; &quot;no&quot; &quot;no&quot; ...
##  $ balance   : int  2143 29 2 1506 1 231 447 2 121 593 ...
##  $ housing   : chr  &quot;yes&quot; &quot;yes&quot; &quot;yes&quot; &quot;yes&quot; ...
##  $ loan      : chr  &quot;no&quot; &quot;no&quot; &quot;yes&quot; &quot;no&quot; ...
##  $ contact   : chr  &quot;unknown&quot; &quot;unknown&quot; &quot;unknown&quot; &quot;unknown&quot; ...
##  $ day       : int  5 5 5 5 5 5 5 5 5 5 ...
##  $ month     : chr  &quot;may&quot; &quot;may&quot; &quot;may&quot; &quot;may&quot; ...
##  $ duration  : int  261 151 76 92 198 139 217 380 50 55 ...
##  $ campaign  : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ pdays     : int  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
##  $ previous  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ poutcome  : chr  &quot;unknown&quot; &quot;unknown&quot; &quot;unknown&quot; &quot;unknown&quot; ...
##  $ subscribed: chr  &quot;no&quot; &quot;no&quot; &quot;no&quot; &quot;no&quot; ...</code></pre>
<pre class="r"><code># The combined dataset contains just shy of 50,000 bank clients</code></pre>
</div>
<div id="tidying-things-up-for-presentation-in-power-bi" class="section level2">
<h2>Tidying things up for presentation in Power BI</h2>
<pre class="r"><code># Ensure proper data types and capitalize factors for Power BI dash
bankdata &lt;- bankdataraw %&gt;%
  mutate(job = as.factor(str_to_title(job)),
         marital = as.factor(str_to_title(marital)),
         education = as.factor(str_to_title(education)),
         default = as.factor(str_to_title(default)),
         housing = as.factor(str_to_title(housing)),
         loan = as.factor(str_to_title(loan)),
         contact = as.factor(str_to_title(contact)),
         month = as.factor(str_to_title(month)),
         poutcome = as.factor(str_to_title(poutcome)),
         subscribed = as.factor(str_to_title(subscribed)))

# Any NA&#39;s in the dataframe?
sum(is.na(bankdata)) # None</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code># Remove raw bank data from environment
rm(bankdataraw)

# A look at the head of the new data
kable(head(bankdata), caption = &quot;Prepared Banking Dataset&quot;) %&gt;%
  kable_paper(&quot;hover&quot;, full_width = F)</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<caption>
<span id="tab:unnamed-chunk-3">Table 2: </span>Prepared Banking Dataset
</caption>
<thead>
<tr>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
job
</th>
<th style="text-align:left;">
marital
</th>
<th style="text-align:left;">
education
</th>
<th style="text-align:left;">
default
</th>
<th style="text-align:right;">
balance
</th>
<th style="text-align:left;">
housing
</th>
<th style="text-align:left;">
loan
</th>
<th style="text-align:left;">
contact
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:left;">
month
</th>
<th style="text-align:right;">
duration
</th>
<th style="text-align:right;">
campaign
</th>
<th style="text-align:right;">
pdays
</th>
<th style="text-align:right;">
previous
</th>
<th style="text-align:left;">
poutcome
</th>
<th style="text-align:left;">
subscribed
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
58
</td>
<td style="text-align:left;">
Management
</td>
<td style="text-align:left;">
Married
</td>
<td style="text-align:left;">
Tertiary
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
2143
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
May
</td>
<td style="text-align:right;">
261
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
44
</td>
<td style="text-align:left;">
Technician
</td>
<td style="text-align:left;">
Single
</td>
<td style="text-align:left;">
Secondary
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
May
</td>
<td style="text-align:right;">
151
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
Entrepreneur
</td>
<td style="text-align:left;">
Married
</td>
<td style="text-align:left;">
Secondary
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
May
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:left;">
Blue-Collar
</td>
<td style="text-align:left;">
Married
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
1506
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
May
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Single
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
May
</td>
<td style="text-align:right;">
198
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:left;">
Management
</td>
<td style="text-align:left;">
Married
</td>
<td style="text-align:left;">
Tertiary
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
231
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
May
</td>
<td style="text-align:right;">
139
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
No
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Write the .csv to be used in Power BI
write.csv(bankdata, file = &quot;bankdata.csv&quot;)</code></pre>
</div>
<div id="summary-statistics" class="section level2">
<h2>Summary statistics</h2>
<pre class="r"><code># A quick overview of the banking client data
fullsummary &lt;- summary(bankdata)
fullsummary</code></pre>
<pre><code>##       age                 job            marital          education    
##  Min.   :18.00   Blue-Collar:10678   Divorced: 5735   Primary  : 7529  
##  1st Qu.:33.00   Management :10427   Married :30011   Secondary:25508  
##  Median :39.00   Technician : 8365   Single  :13986   Tertiary :14651  
##  Mean   :40.96   Admin.     : 5649                    Unknown  : 2044  
##  3rd Qu.:48.00   Services   : 4571                                     
##  Max.   :95.00   Retired    : 2494                                     
##                  (Other)    : 7548                                     
##  default        balance       housing      loan            contact     
##  No :48841   Min.   : -8019   No :22043   No :41797   Cellular :32181  
##  Yes:  891   1st Qu.:    72   Yes:27689   Yes: 7935   Telephone: 3207  
##              Median :   448                           Unknown  :14344  
##              Mean   :  1368                                            
##              3rd Qu.:  1431                                            
##              Max.   :102127                                            
##                                                                        
##       day            month          duration         campaign     
##  Min.   : 1.00   May    :15164   Min.   :   0.0   Min.   : 1.000  
##  1st Qu.: 8.00   Jul    : 7601   1st Qu.: 103.0   1st Qu.: 1.000  
##  Median :16.00   Aug    : 6880   Median : 180.0   Median : 2.000  
##  Mean   :15.82   Jun    : 5872   Mean   : 258.7   Mean   : 2.767  
##  3rd Qu.:21.00   Nov    : 4359   3rd Qu.: 320.0   3rd Qu.: 3.000  
##  Max.   :31.00   Apr    : 3225   Max.   :4918.0   Max.   :63.000  
##                  (Other): 6631                                    
##      pdays           previous           poutcome     subscribed 
##  Min.   : -1.00   Min.   :  0.0000   Failure: 5391   No :43922  
##  1st Qu.: -1.00   1st Qu.:  0.0000   Other  : 2037   Yes: 5810  
##  Median : -1.00   Median :  0.0000   Success: 1640              
##  Mean   : 40.16   Mean   :  0.5769   Unknown:40664              
##  3rd Qu.: -1.00   3rd Qu.:  0.0000                              
##  Max.   :871.00   Max.   :275.0000                              
## </code></pre>
<p>Notes:</p>
<ul>
<li>Half of all clients are between 33 and 48 years old.</li>
<li>Most clients work blue-collar or management jobs (around 21% for each).</li>
<li>About 3/5 clients are married.</li>
<li>Most clients have at least a secondary education (80%).</li>
<li>A very small portion (1.79%) of clients are in default.</li>
<li>More clients have housing loans than do not, but it’s not a huge difference (55% vs. 45%).</li>
<li>Most clients don’t have a personal loan. Only about 16% do.</li>
<li>If a client was contacted, they were probably contacted through their cellular (64%).</li>
<li>Most clients were contacted in May (30%). Late spring into summer is most popular for contact.</li>
<li>Half of all contacts made with customers lasted between 1:43 and 5:20.</li>
<li>The average customer was contacted twice during this campaign.</li>
<li>Only 25% of customers were contacted three or more times.</li>
<li>Most customers have not been contacted prior to this campaign.</li>
<li>Only 11.68% of customers have subscribed to a term deposit.</li>
</ul>
</div>
